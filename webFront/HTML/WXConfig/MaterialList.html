<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>微信基本接口</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="/HTML/layui/css/layui.css" rel="stylesheet" />
    <script src="/HTML/JS/jquery-3.3.1.min.js"></script>
    <script src="/HTML/JS/vue.min.js"></script>
    <script src="/HTML/layui/layui.all.js"></script>
    <script src="/HTML/JS/echarts.min.js"></script>
    <script src="/HTML/JS/colResizable.js"></script>
    <style>
        .layui-form-label {
            width: 150px;
        }
    </style>
</head>
<body>
    <label class="layui-label" style="color:#ff0000;margin-left:50px;">每天获取有次数限制，未使用数据库，缓存功能！</label>
    <div id="app" style="margin:10px;">
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">获取素材列表</label>
            <div class="layui-input-block" style="display:flex">
                <select class="layui-select" v-model="search.sc.type" :value="search.sc.type">
                    <option value="image">图片</option>
                    <option value="video">视频</option>
                    <option value="voice">语音</option>
                    <option value="news">图文</option>
                </select>
                <input class="layui-input" type="text" placeholder="请输入素材列表的起始数" :value="search.sc.offset" v-model="search.sc.offset" style="width:80px;margin-left:3px;" />
                <button class="layui-btn" type="button" style="width:80px;margin-right:10px;margin-left:5px;" @click="getsclist">
                    <i class="layui-icon layui-icon-search"></i>查询
                </button>
                <textarea name="desc" placeholder="" class="layui-textarea" v-model="model.SClist" :value="model.SClist"></textarea>
            </div>
        </div>
        <fieldset>
            <legend>素材详情信息</legend>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">素材总数</label>
                <div class="layui-input-block">
                    <label class="layui-form-label">{{lis.total_count}}</label>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">调用获取的数量</label>
                <div class="layui-input-block">
                    <label class="layui-form-label">{{lis.item_count}}</label>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">素材列表</label>
                <div class="layui-input-block">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                <th>操作</th>
                                <th>文件名称</th>
                                <th>mediaID</th>
                                <th>图文页的URL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item,index)  in lis.item" v-if="lis.item.length>0">
                                <td style="display:flex">
                                    <button class="layui-btn layui-btn-warm" type="button" @click="btn_details(item)">查看</button>
                                    <button class="layui-btn layui-btn-danger" type="button" @click="btn_delete(item.media_id,index)">删除</button>
                                </td>
                                <td>{{item.name}}</td>
                                <td>{{item.media_id}}</td>
                                <td>{{item.url}}</td>
                            </tr>
                            <tr v-if="lis.item.length==0" align="center">
                                <td colspan="4">暂无数据</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
</body>
</html>
<script>

    //let _data = {
    //    "item": [
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL8wrhkKXFzyiAD93dvn9aoCw",
    //            "content":
    //            {
    //                "news_item": [
    //                    {
    //                        "title": "投票",
    //                        "author": "",
    //                        "digest": "而又特然",
    //                        "content": "<p>&nbsp;的双方各<\/p><p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQhupMLcNkOWO2icdEVeiciaO5n8Nqjw5ziaVaO2iajlUqZ3Y2MRlhdhy2WGw\/0?wx_fmt=jpeg\" data-ratio=\"1.25\" data-w=\"120\"  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p>当然很高<\/p><p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQMUE93bYADZXovYvtNj0g2ic6k4iaNdmE6YJtbUDWQibrE9bu4FMHcoL5w\/0?wx_fmt=jpeg\" data-ratio=\"1.25\" data-w=\"120\"  \/><\/p><p>发过火<\/p><p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQ5rHtNI6QrERQHW4V7I57k8LIDbrnYV5dAnj0E2AibET3g47STozoXPQ\/0?wx_fmt=jpeg\" data-ratio=\"1.4328358208955223\" data-w=\"268\"  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p><br  \/><\/p><p><span class=\"vote_area\"><iframe scrolling=\"no\" frameborder=\"0\" class=\"vote_iframe js_editor_vote_card\" data-display-style=\"height: 172px;\" data-display-src=\"\/cgi-bin\/readtemplate?t=vote\/vote-new_tmpl&amp;__biz=MzU0NjAzNjA5OQ==&amp;supervoteid=508595260&amp;token=1148054961&amp;lang=zh_CN\" data-src=\"\/mp\/newappmsgvote?action=show&amp;__biz=MzU0NjAzNjA5OQ==&amp;supervoteid=508595260#wechat_redirect\" data-supervoteid=\"508595260\" allowfullscreen=\"\"><\/iframe><span class=\"vote_box skin_help po_left\"><\/span><span class=\"vote_box skin_help po_right\"><\/span><\/span><\/p>", "content_source_url": "", "thumb_media_id": "9DAHwaSUT4tp6qphy4HL8962vO_MvX7ZkgTz6NV6yQw", "show_cover_pic": 0, "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000091&idx=1&sn=51f6671a9b297ba67db8cbefba82ef74&chksm=7b6281b74c1508a10205158756186a2e40788095cd513ff34cf58ef028e716224c2cb9df3909#rd", "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQMUE93bYADZXovYvtNj0g2ic6k4iaNdmE6YJtbUDWQibrE9bu4FMHcoL5w\/0?wx_fmt=jpeg", "need_open_comment": 0, "only_fans_can_comment": 0
    //                    }],
    //                "create_time": 1491617510,
    //                "update_time": 1491617652
    //            }, "update_time": 1491617652
    //        },
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL8y0-anhSOYILefIk9uKcdwA",
    //            "content":
    //            {
    //                "news_item":
    //                    [
    //                        {
    //                            "title": "水电费", "author": "", "digest": "水电费", "content": "<p>水电费<span class=\"vote_area\"><iframe scrolling=\"no\" frameborder=\"0\" class=\"vote_iframe js_editor_vote_card\" data-display-style=\"height: 172px;\" data-display-src=\"\/cgi-bin\/readtemplate?t=vote\/vote-new_tmpl&amp;__biz=MzU0NjAzNjA5OQ==&amp;supervoteid=508595160&amp;token=1148054961&amp;lang=zh_CN\" data-src=\"\/mp\/newappmsgvote?action=show&amp;__biz=MzU0NjAzNjA5OQ==&amp;supervoteid=508595160#wechat_redirect\" data-supervoteid=\"508595160\" allowfullscreen=\"\"><\/iframe><span class=\"vote_box skin_help po_left\"><\/span><span class=\"vote_box skin_help po_right\"><\/span><\/span><\/p>", "content_source_url": "", "thumb_media_id": "9DAHwaSUT4tp6qphy4HL80-BAiEr8j_R7Q57N37Gg4c", "show_cover_pic": 0, "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000090&idx=1&sn=80a5cf7d034e52ac04e0632b8017e44c&chksm=7b6281b64c1508a0e69f04264ceeab1d0eeb6ce1ad0fddb55ea410f6b5bce9b8005e82cba0d9#rd", "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQGOrrNIh62gy4gLrzYHfY26nz8CUDzNXfyTlungz1z2gjZiaibicSnWZvQ\/0?wx_fmt=jpeg", "need_open_comment": 0, "only_fans_can_comment": 0
    //                        }],
    //                "create_time": 1491617008,
    //                "update_time": 1491617015
    //            }, "update_time": 1491617015
    //        },
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL85qhVJ5fugmlvjKJMIOqeu4",
    //            "content":
    //            {
    //                "news_item": [
    //                    {
    //                        "title": "求魔", "author": "", "digest": "www.23sw.net\/0\/519\/", "content": "<p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQGOrrNIh62gy4gLrzYHfY26nz8CUDzNXfyTlungz1z2gjZiaibicSnWZvQ\/0?wx_fmt=jpeg\" data-ratio=\"1.4514925373134329\" data-w=\"268\"  \/><\/p><p>www.23sw.net\/0\/519\/<\/p>", "content_source_url": "", "thumb_media_id": "9DAHwaSUT4tp6qphy4HL80-BAiEr8j_R7Q57N37Gg4c", "show_cover_pic": 0, "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000089&idx=1&sn=dd38a7b7afff70deed42c66f4bbfedcc&chksm=7b6281b54c1508a3e858f6331e7945e43f781b3409ade5f46942fc6f195c706093287fae3425#rd", "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQGOrrNIh62gy4gLrzYHfY26nz8CUDzNXfyTlungz1z2gjZiaibicSnWZvQ\/0?wx_fmt=jpeg", "need_open_comment": 0, "only_fans_can_comment": 0
    //                    }
    //                ], "create_time": 1490535706,
    //                "update_time": 1490535766
    //            }, "update_time": 1490535766
    //        },
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL87xmEwUBZPaKbMaCEEK4XZY",
    //            "content":
    //            {
    //                "news_item": [
    //                    {
    //                        "title": "我欲封天", "author": "", "digest": "www.37zw.com\/2\/2799\/", "content": "<p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQhupMLcNkOWO2icdEVeiciaO5n8Nqjw5ziaVaO2iajlUqZ3Y2MRlhdhy2WGw\/0?wx_fmt=jpeg\" data-ratio=\"1.25\" data-w=\"120\"  \/><\/p><p><span style=\"color: rgb(34, 34, 34); font-family: &#39;Helvetica Neue&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, 黑体, Arial, sans-serif; font-size: 14px; line-height: normal;  background-color: rgb(255, 255, 255);\">www.37zw.com\/2\/2799\/<\/span><\/p>", "content_source_url": "", "thumb_media_id": "9DAHwaSUT4tp6qphy4HL8_OKmfNk9gnoA2BY9Fp03-8", "show_cover_pic": 0, "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000087&idx=1&sn=b17d289066ba15bf17d6c449e985ec33&chksm=7b6281bb4c1508add1c10ada8b5ff45219c8b5bd9fded89c5cfba7bccbf17e558de085fb8350#rd", "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQhupMLcNkOWO2icdEVeiciaO5n8Nqjw5ziaVaO2iajlUqZ3Y2MRlhdhy2WGw\/0?wx_fmt=jpeg", "need_open_comment": 0, "only_fans_can_comment": 0
    //                    }],
    //                "create_time": 1490535653,
    //                "update_time": 1490535781
    //            }, "update_time": 1490535781
    //        },
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL83UEu8BE0bBFsDEI5t3FfmE",
    //            "content":
    //            {
    //                "news_item": [
    //                    {
    //                        "title": "一念永恒", "author": "", "digest": "www.biqukan.com\/1_1094\/", "content": "<p><img data-s=\"300,640\" data-type=\"jpeg\" data-src=\"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQMUE93bYADZXovYvtNj0g2ic6k4iaNdmE6YJtbUDWQibrE9bu4FMHcoL5w\/0?wx_fmt=jpeg\" data-ratio=\"1.25\" data-w=\"120\"  \/><\/p><p><span style=\"color: rgb(34, 34, 34); font-family: &#39;Helvetica Neue&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, 黑体, Arial, sans-serif; font-size: 14px; line-height: normal;  background-color: rgb(255, 255, 255);\">www.biqukan.com\/1_1094\/<\/span><\/p>", "content_source_url": "", "thumb_media_id": "9DAHwaSUT4tp6qphy4HL8962vO_MvX7ZkgTz6NV6yQw", "show_cover_pic": 0, "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000085&idx=1&sn=eef4e4aaf029bdbcc706aec746543488&chksm=7b6281b94c1508af3a180dbacc9cfb3ca167144a82071f556447238f61ec8b142e5511278c20#rd", "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQMUE93bYADZXovYvtNj0g2ic6k4iaNdmE6YJtbUDWQibrE9bu4FMHcoL5w\/0?wx_fmt=jpeg", "need_open_comment": 0, "only_fans_can_comment": 0
    //                    }],
    //                "create_time": 1490535600,
    //                "update_time": 1490535795
    //            }, "update_time": 1490535795
    //        },
    //        {
    //            "media_id": "9DAHwaSUT4tp6qphy4HL8-0i2nuo79Wz_5tbTXweFFI",
    //            "content":
    //            {
    //                "news_item":
    //                    [
    //                        {

    //                            "title": "1-6",
    //                            "author": "。",
    //                            "digest": `第一章 离乡       铁柱坐在村内的小路边，望着蔚蓝`,
    //                            "content": `测试`,
    //                            "content_source_url": "",
    //                            "thumb_media_id": "9DAHwaSUT4tp6qphy4HL89mFrYnDTc0bE1go6njBvSI",
    //                            "show_cover_pic": 0,
    //                            "url": "http://mp.weixin.qq.com/s?__biz=MzU0NjAzNjA5OQ==&mid=100000082&idx=1&sn=f033273667d3682e039add99f8fead69&chksm=7b6281be4c1508a889ffec451b1e0a50abdc6e363e8d847c9739498bd8d528d027bf59512601#rd",
    //                            "thumb_url": "http://mmbiz.qpic.cn/mmbiz_jpg/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQ5rHtNI6QrERQHW4V7I57k8LIDbrnYV5dAnj0E2AibET3g47STozoXPQ/0?wx_fmt=jpeg",
    //                            "need_open_comment": 0,
    //                            "only_fans_can_comment": 0
    //                        },
    //                        {
    //                            "title": "7—12",
    //                            "author": "",
    //                            "digest": "第七章 留书“可不是嘛，四哥，你把名额给老二，我们是替你觉得不值，王卓那孩子刚才说的对，虎子一定比铁柱强，说",
    //                            "content": ` ces `,
    //                            "content_source_url": "",
    //                            "thumb_media_id": "9DAHwaSUT4tp6qphy4HL89mFrYnDTc0bE1go6njBvSI", "show_cover_pic": 0,
    //                            "url": "http:\/\/mp.weixin.qq.com\/s?__biz=MzU0NjAzNjA5OQ==&mid=100000082&idx=2&sn=a98b5206f90b2902487dd8291f94f50d&chksm=7b6281be4c1508a8fd1a67bbad04ced3e11ae1db29fda19c426bcb354f0c5e6552dbacb4219e#rd",
    //                            "thumb_url": "http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/o6ice2PzTQ7cKIQg86ngialDrC8vLgdcnQ5rHtNI6QrERQHW4V7I57k8LIDbrnYV5dAnj0E2AibET3g47STozoXPQ\/0?wx_fmt=jpeg",
    //                            "need_open_comment": 0,
    //                            "only_fans_can_comment": 0
    //                        },
    //                    ],
    //                "create_time": 1490533358,
    //                "update_time": 1490534957
    //            },
    //            "update_time": 1490534957
    //        }
    //    ], "total_count": 10, "item_count": 10
    //};

    let $frame = top.$frame;
    var vm = new Vue({
        el: '#app',
        data: {
            model: { Token: '', SClist: [] },
            search: {
                sc: { type: 'image', offset: 0, count: 20 },
            },
            pagingdata: [],
            lis: { total_count: 0, item_count: 0, item: [] },
        },
        created: function () {
           // this.lis = _data;
        },
        computed: {


        },
        methods: {
            gettoken() {
                o.gettoken();
            },
            getsclist() {
                o.getsclist();
            },
            btn_details(item) {
                top.vm.iframedata = item;
                let obj = {
                    id: 'form',
                    title: '素材详情',
                    url: 'WXConfig/MaterialForm.html',
                    width: 1200,
                    height: 700,
                    btn: null,
                    callBack: function (id) {

                    }
                }
                $frame.layerForm(obj);

            },
            btn_delete(media_id, index) {
                $frame.confirm("提示", `确定要删除(${media_id})素材吗？`, (r) => {
                    if(r)
                    o.delete(media_id, index);
                })
               
            }
        }
    });

    var o = {
        load() {


        },
        bind() {

        },
        getsclist() {
            $frame.RequestGet('WXData/GetSCList', { data: JSON.stringify(vm.search.sc) }, (x) => {
                if (x.Success) {
                    vm.model.SClist = x.Data;
                    vm.lis = JSON.parse(x.Data);
                } else
                    $frame.alert(x.Data);
            });
        },
        delete(mid,index) {
            $frame.RequestGet('WXData/DeleteSC?mid=' + mid,'', (x) => {
                if (x.Success) {
                    var res = JSON.parse(x.Data);
                    if (res.errcode == 0) {
                        vm.lis.item.splice(index, 1);
                        $frame.alert("操作成功！");
                    } else {
                        $frame.alert(x.Data);
                    }
                } else
                    $frame.alert(x.Data);
            });

        }
    }
</script>